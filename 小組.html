<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.18/c3.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.18/c3.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body {
            display: flex;
            flex-wrap: wrap;
        }

        div {
            text-align: center;
        }
    </style>
    <title>Document</title>
</head>

<body>
    <div class="salary_score">
        <div id="chart1"></div>
        <p>接案公司的薪資滿意度平均分</p>
    </div>
    <div class="score">
        <div id="chart2"></div>
        <p>博弈、電商公司兩個產業滿意度的平均分</p>
    </div>
    <div class="gender">
        <div id="chart3"></div>
        <p>前端工程師男女比例</p>
    </div>
    <div class="salary">
        <div id="chart4"></div>
        <p>前端工程師薪水區間分佈</p>
    </div>
</body>
<script>
    const url = 'https://raw.githubusercontent.com/hexschool/2021-ui-frontend-job/master/frontend_data.json?token=AAQWFQDSNRRXC6FBW7PDSETBOESVW';

    axios.get(url)
        .then(res => {
            const data = res.data;
            const total = {}; //各家公司的薪資滿意度平均分數 + 產業滿意度的平均分數
            const salary = data.reduce((a, b) => {
                a[b.company.salary] ? a[b.company.salary]++ : a[b.company.salary] = 1;
                return a;
            }, {});//薪水區間分佈
            const gender = data.reduce((a, b) => {
                a[b.gender] ? a[b.gender]++ : a[b.gender] = 1;
                return a;
            }, {});//男性跟女性比例
            data.forEach(item => {
                if (total[item.company.industry]) {
                    total[item.company.industry].num++;
                    total[item.company.industry].salary_score += item.company.salary_score * 1;
                    total[item.company.industry].score += item.company.score * 1;
                } else {
                    total[item.company.industry] = {
                        num: 1,
                        salary_score: item.company.salary_score * 1,
                        score: item.company.score * 1
                    };
                };
            });
            for (const key in total) {
                total[key].salary_score = Math.round(total[key].salary_score * 10 / total[key].num) / 10;
                total[key].score = Math.round(total[key].score * 10 / total[key].num) / 10;
            };

            //資料處理
            //接案公司的薪資滿意度平均分數
            const newSalary_score = [];
            const newScore = [];
            for (const key in total) {
                if (key === '接案公司') {
                    newSalary_score.push('薪資滿意度', total[key].salary_score)
                }
                console.log(key);
                if (key === '博奕' || key === '電子商務') {
                    console.log(total[key]);
                }
            }
            // 男女比例
            const newGender = [];
            for (const key in gender) {
                newGender.push([key, gender[key]]);
            };
            //薪水區間分佈
            const newSalary = [];
            for (const key in salary) {
                newSalary.push([key, salary[key]]);
            };
            //一條長條圖：接案公司的薪資滿意度平均分數
            var chart1 = c3.generate({
                bindto: '#chart1',
                data: {
                    columns: [newSalary_score],
                    type: 'bar'
                },
                bar: {
                    width: {
                        ratio: 0.5
                    }
                },
                axis: {
                    x: {
                        type: 'category',
                        categories: ['接案公司']
                    }
                }
            });
            //二條長條圖：抓取博弈、電商公司兩個產業滿意度的平均分數
            var chart2 = c3.generate({
                bindto: '#chart2',
                data: {
                    columns: [newSalary_score],
                    type: 'bar'
                },
                bar: {
                    width: {
                        ratio: 0.5
                    }
                },
                axis: {
                    x: {
                        type: 'category',
                        categories: ['接案公司']
                    }
                }
            });
            //圓餅圖：撈取男性跟女性比例有多少
            const chart3 = c3.generate({
                bindto: '#chart3',
                size: {
                    height: 240,
                    width: 480
                },
                data: {
                    columns: newGender,
                    type: 'pie'
                },
                legend: {
                    position: 'right'
                }
            });
            //圓餅圖：顯示薪水區間分佈
            const chart4 = c3.generate({
                bindto: '#chart4',
                size: {
                    height: 240,
                    width: 480
                },
                data: {
                    columns: newSalary,
                    type: 'pie'
                },
                legend: {
                    position: 'right'
                }
            });
        });
</script>

</html>